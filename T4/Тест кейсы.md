### **Тест-кейсы для взаимодействия Сервисов A и B через RabbitMQ (AMQP)**

#### **TC-01: Успешное подключение услуги через команду /connect**

**Severity:** Critical  
**Предусловия:**
- Сервис A развернут и доступен по REST API
- Сервис B развернут и функционирует
- RabbitMQ с настроенной очередью подключен и доступен
- Услуга находится в статусе `disconnected`

**Шаги:**
1. Отправить POST-запрос на `/connect` в Сервис A
2. Проверить передачу команды в очередь RabbitMQ
3. Убедиться, что Сервис B получил и обработал команду
4. Проверить обновление статуса услуги в Сервисе A

**Ожидаемый результат:**
- HTTP 200 OK от Сервиса A
- Сообщение передано через RabbitMQ
- Сервис B обработал сообщение и вернул подтверждение
- Внутренний статус услуги изменён на `connected`

#### **TC-02: Успешное отключение услуги через команду /disconnect**

**Severity:** Critical  
**Предусловия:**
- Сервис A развернут и доступен по REST API
- Сервис B развернут и функционирует
- RabbitMQ с настроенной очередью подключен и доступен
- Услуга находится в статусе `connected`

**Шаги:**
1. Отправить POST-запрос на `/disconnect` в Сервис A
2. Проверить передачу команды в очередь RabbitMQ
3. Сервис B обработал сообщение и вернул подтверждение
4. Проверить обновление статуса услуги  в Сервисе A

**Ожидаемый результат:**
- HTTP 200 OK от Сервиса A
- Сообщение передано через RabbitMQ
- Сервис B обработал сообщение и вернул подтверждение
- Внутренний статус услуги изменён на `disconnected`

#### **TC-03: Успешная блокировка услуги через команду /block**

**Severity:** Critical  
**Предусловия:**
- Сервис A развернут и доступен по REST API
- Сервис B развернут и функционирует
- RabbitMQ с настроенной очередью подключен и доступен
- Услуга находится в статусе `connected`

**Шаги:**
1. Отправить POST-запрос на `/block` в Сервис A
2. Проверить отправку команды в очередь RabbitMQ
3. Сервис B обработал сообщение и вернул подтверждение
4. Проверить обновление статуса услуги в Сервисе A

**Ожидаемый результат:**
- HTTP 200 OK от Сервиса A
- Сообщение передано через RabbitMQ
- Сервис B обработал сообщение и вернул подтверждение
- Внутренний статус услуги изменён на `blocked`

#### **TC-04: Проверка последовательной обработки команд**

**Severity:** Critical  
**Предусловия:**
- Сервис A развернут и доступен по REST API
- Сервис B развернут и функционирует
- RabbitMQ с настроенной очередью подключен и доступен
- Услуга находится в статусе `disconnected`

**Шаги:**
1. Отправить POST-запрос с первой командой в Сервис A
2. Не дожидаясь ответа, отправить POST-запрос на со второй командой
3. Проверить, что в очередь RabbitMQ отправлена только первая команда
4. Дождаться ответа от B на первую команду
5. Убедиться, что только после этого вторая команда была отправлена в очередь
6. 4. Проверить статус услуги в Сервисе A

| №   | Начальный статус | Первая команда | Вторая команда | Финальный статус |
| --- | ---------------- | -------------- | -------------- | ---------------- |
| 1   | disconnected     | /connect       | /disconnect    | disconnected     |
| 2   | connected        | /disconnect    | /connect       | connected        |
| 3   | disconnected     | /connect       | /block         | blocked          |
| 4   | connected        | /block         | /disconnect    | disconnected     |
| 5   | connected        | /disconnect    | /block         | blocked          |
| 6   | disconnected     | /connect       | /connect       | connected        |

**Ожидаемый результат:**
- Команды выполняются строго последовательно
- Вторая команда не отправляется, пока не получен ответ на первую
- В логах отражена последовательность выполнения

#### **TC-05: Обработка повторного подключения активной услуги**

**Severity:** Major  
**Предусловия:**
- Сервис A развернут и доступен по REST API
- Сервис B развернут и функционирует
- RabbitMQ с настроенной очередью подключен и доступен
- Услуга находится в статусе `connected`

**Шаги:**
1. Отправить POST-запрос с командой в Сервис A
2. Проверить реакцию сервиса

| №   | Начальный статус | Команда     |
| --- | ---------------- | ----------- |
| 1   | connected        | /connect    |
| 2   | disconnected     | /disconnect |
| 3   | blocked          | /block      |

**Ожидаемый результат:**
- Система корректно обрабатывает дублирующую команду
- Ответ HTTP 200 OK с сообщением, что услуга уже имеет данный статус
- Статус услуги остается неизменным

#### **TC-06: Обработка ситуации недоступности Сервиса B**

**Severity:** Blocker  
**Предусловия:**
- Сервис A развернут и доступен по REST API
- Сервис B остановлен или недоступен
- RabbitMQ с настроенной очередью подключен и доступен
- Услуга находится в начальном статусе из таблицы

**Шаги:**
1. Отправить POST-запрос с командой в Сервис A
2. Убедиться, что сообщение ушло в RabbitMQ
3. Проверить, что ответ от B не приходит в течение заданного тайм-аута
4. Проверить поведение Сервиса A

| №   | Начальный статус | Команда     |
| --- | ---------------- | ----------- |
| 1   | disconnected     | /connect    |
| 2   | connected        | /disconnect |
| 3   | connected        | /block      |

**Ожидаемый результат:**
- Сервис A возвращает HTTP 504 Gateway Timeout
- В логах отражена ошибка получения ответа
- Статус услуги остаётся неизменным

#### **TC-07: Обработка сбоя в работе RabbitMQ**

**Severity:** Blocker  
**Предусловия:**
- Сервис A развернут и доступен по REST API
- Сервис B развернут и функционирует
- Очередь RabbitMQ недоступна или удалена
- Услуга находится в начальном статусе из таблицы

**Шаги:**
1. Отправить POST-запрос с командой в Сервис A
2. Проверить, что сообщение не может быть доставлено в очередь
3. Проверить статус ответа и запись в лог

| №   | Начальный статус | Команда     |
| --- | ---------------- | ----------- |
| 1   | disconnected     | /connect    |
| 2   | connected        | /disconnect |
| 3   | connected        | /block      |


**Ожидаемый результат:**
- HTTP 500 Internal Server Error от Сервиса A
- Лог содержит информацию о сбое отправки сообщения в очередь
- Статус услуги не изменяется

#### **TC-08: Обработка некорректного ответа от Сервиса B**

**Severity:** Critical  
**Предусловия:**
- Сервис A развернут и доступен по REST API
- Сервис B настроен на возврат некорректного ответа
- RabbitMQ с настроенной очередью подключен и доступен
- Услуга находится в статусе `disconnected`

**Шаги:**
1. Отправить POST-запрос на `/connect` в Сервис A
2. Убедиться, что сообщение отправлено в очередь
3. Получить от B некорректный ответ
4. Проверить поведение Сервиса A

**Ожидаемый результат:**
- Команда не считается выполненной
- Статус услуги не меняется
- В логах записана ошибка десериализации или валидации

#### **TC-09: Обработка пустого ответа от Сервиса B**

**Severity:** Major  
**Предусловия:**
- Сервис A развернут и доступен по REST API
- Сервис B настроен на возврат пустого ответа
- RabbitMQ с настроенной очередью подключен и доступен
- Услуга находится в статусе `disconnected`

**Шаги:**
1. Отправить POST-запрос на `/connect` в Сервис A
2. Получить пустой ответ от Сервиса B
3. Проверить поведение Сервиса A

**Ожидаемый результат:**
- HTTP 500 Internal Server Error от Сервиса A
- Команда не завершается успешно
- Лог содержит информацию о пустом ответе

#### **TC-10: Проверка полноты журналирования операций**

**Severity:** Major  
**Предусловия:**
- Сервис A развернут и доступен по REST API
- Сервис B развернут и функционирует
- RabbitMQ с настроенной очередью подключен и доступен
- Услуга находится в статусе `disconnected`

**Шаги:**
1. Выполнить несколько команд `/connect`, `/disconnect`, `/block`
2. Дождаться завершения каждого запроса
3. Просмотреть логи Сервиса A

**Ожидаемый результат:**
- Все ключевые события зафиксированы в логах
- Логи содержат полную информацию о выполненных операциях